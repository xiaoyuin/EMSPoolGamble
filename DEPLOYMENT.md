# EMS Pool Gamble éƒ¨ç½²æŒ‡å—

è¿™æ˜¯ä¸€ä¸ªå®Œæ•´çš„éƒ¨ç½²è§£å†³æ–¹æ¡ˆï¼ŒåŒ…å«äº†åœ¨å…¨æ–° Linux ç¯å¢ƒä¸­éƒ¨ç½² EMS Pool Gamble åº”ç”¨æ‰€éœ€çš„æ‰€æœ‰è„šæœ¬å’Œå·¥å…·ã€‚

## ğŸš€ å¿«é€Ÿéƒ¨ç½²

### æ–¹æ³•ä¸€ï¼šä½¿ç”¨ç®¡ç†å·¥å…·ï¼ˆæ¨èï¼‰

```bash
# ä¸‹è½½é¡¹ç›®ä»£ç 
git clone <repository-url>
cd EMSPoolGamble

# è¿è¡Œç®¡ç†å·¥å…·
./manage.sh
```

ç„¶åé€‰æ‹© "1) é¦–æ¬¡éƒ¨ç½²" å³å¯è‡ªåŠ¨å®Œæˆæ‰€æœ‰é…ç½®ã€‚

### æ–¹æ³•äºŒï¼šç›´æ¥è¿è¡Œéƒ¨ç½²è„šæœ¬

```bash
# è¿è¡Œä¸€é”®éƒ¨ç½²è„šæœ¬
./deploy.sh
```

## ğŸ“‹ éƒ¨ç½²è„šæœ¬è¯´æ˜

### 1. `deploy.sh` - ä¸€é”®éƒ¨ç½²è„šæœ¬
- **åŠŸèƒ½**: åœ¨å…¨æ–°çš„ Linux ç¯å¢ƒä¸­è‡ªåŠ¨éƒ¨ç½²åº”ç”¨
- **æ”¯æŒ**: Ubuntu/Debian å’Œ CentOS/RHEL
- **åŒ…å«**:
  - ç³»ç»Ÿä¾èµ–å®‰è£… (Python3, Nginx, Supervisor)
  - Python è™šæ‹Ÿç¯å¢ƒåˆ›å»º
  - æ•°æ®æŒä¹…åŒ–é…ç½®
  - Nginx åå‘ä»£ç†é…ç½®
  - Supervisor è¿›ç¨‹ç®¡ç†é…ç½®
  - æœåŠ¡å¯åŠ¨å’ŒçŠ¶æ€æ£€æŸ¥

### 2. `update.sh` - æ›´æ–°éƒ¨ç½²è„šæœ¬
- **åŠŸèƒ½**: æ›´æ–°åº”ç”¨ä»£ç ä½†ä¿ç•™æ•°æ®
- **åŒ…å«**:
  - è‡ªåŠ¨æ•°æ®å¤‡ä»½
  - ä»£ç æ›´æ–° (æ”¯æŒ Git)
  - ä¾èµ–æ›´æ–°
  - æ•°æ®åº“è¿ç§»
  - æœåŠ¡é‡å¯

### 3. `backup.sh` - æ•°æ®å¤‡ä»½è„šæœ¬
- **åŠŸèƒ½**: å®Œæ•´çš„æ•°æ®å¤‡ä»½å’Œæ¢å¤è§£å†³æ–¹æ¡ˆ
- **æ”¯æŒæ“ä½œ**:
  - `./backup.sh backup` - åˆ›å»ºå¤‡ä»½
  - `./backup.sh list` - åˆ—å‡ºå¤‡ä»½
  - `./backup.sh restore <file>` - æ¢å¤æ•°æ®
  - `./backup.sh cleanup` - æ¸…ç†æ—§å¤‡ä»½

### 4. `check.sh` - ç¯å¢ƒæ£€æŸ¥è„šæœ¬
- **åŠŸèƒ½**: å…¨é¢çš„ç³»ç»Ÿå’Œåº”ç”¨å¥åº·æ£€æŸ¥
- **æ£€æŸ¥é¡¹ç›®**:
  - ç³»ç»Ÿä¿¡æ¯å’Œèµ„æº
  - å¿…éœ€å‘½ä»¤å’Œä¾èµ–
  - Python ç¯å¢ƒ
  - æ•°æ®æŒä¹…åŒ–é…ç½®
  - æœåŠ¡çŠ¶æ€
  - ç½‘ç»œè¿é€šæ€§
  - æ—¥å¿—æ–‡ä»¶
  - æ€§èƒ½æŒ‡æ ‡

### 5. `manage.sh` - ç»Ÿä¸€ç®¡ç†å·¥å…·
- **åŠŸèƒ½**: äº¤äº’å¼ç®¡ç†ç•Œé¢
- **åŒ…å«**: æ‰€æœ‰å¸¸ç”¨ç®¡ç†æ“ä½œçš„å›¾å½¢åŒ–èœå•

## ğŸ—„ï¸ æ•°æ®æŒä¹…åŒ–

### æ•°æ®å­˜å‚¨ä½ç½®
- **æ•°æ®ç›®å½•**: `/opt/ems-pool-gamble-data/`
- **æ•°æ®åº“æ–‡ä»¶**: `/opt/ems-pool-gamble-data/ems_pool_gamble.db`
- **åº”ç”¨è½¯é“¾æ¥**: `instance/ems_pool_gamble.db` â†’ æ•°æ®ç›®å½•

### å¤‡ä»½ç­–ç•¥
- **è‡ªåŠ¨å¤‡ä»½**: æ¯æ¬¡æ›´æ–°å‰è‡ªåŠ¨åˆ›å»ºå¤‡ä»½
- **å‹ç¼©å­˜å‚¨**: å¤‡ä»½æ–‡ä»¶è‡ªåŠ¨ gzip å‹ç¼©
- **è‡ªåŠ¨æ¸…ç†**: ä¿ç•™ 30 å¤©å†…çš„å¤‡ä»½æ–‡ä»¶
- **å¤‡ä»½ä½ç½®**: `/opt/ems-pool-gamble-backups/`

## ğŸ”§ æœåŠ¡é…ç½®

### Nginx é…ç½®
- **ç«¯å£**: 80 (HTTP)
- **ä»£ç†**: è½¬å‘åˆ°å†…éƒ¨ 8000 ç«¯å£
- **é…ç½®æ–‡ä»¶**: `/etc/nginx/sites-available/ems-pool-gamble`

### Supervisor é…ç½®
- **æœåŠ¡å**: `ems-pool-gamble`
- **è¿›ç¨‹æ•°**: 2 ä¸ª Gunicorn worker
- **è‡ªåŠ¨é‡å¯**: å¯ç”¨
- **æ—¥å¿—æ–‡ä»¶**: `/var/log/ems-pool-gamble.log`

### ç¯å¢ƒå˜é‡
- **SECRET_KEY**: è‡ªåŠ¨ç”Ÿæˆçš„å®‰å…¨å¯†é’¥
- **DATABASE_URL**: SQLite æ•°æ®åº“è·¯å¾„

## ğŸš¦ å¸¸ç”¨ç®¡ç†å‘½ä»¤

### æœåŠ¡ç®¡ç†
```bash
# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
sudo supervisorctl status ems-pool-gamble

# é‡å¯åº”ç”¨
sudo supervisorctl restart ems-pool-gamble

# æŸ¥çœ‹æ—¥å¿—
sudo tail -f /var/log/ems-pool-gamble.log

# é‡å¯ Nginx
sudo systemctl restart nginx
```

### æ•°æ®ç®¡ç†
```bash
# åˆ›å»ºå¤‡ä»½
./backup.sh backup

# æŸ¥çœ‹å¤‡ä»½åˆ—è¡¨
./backup.sh list

# æ¢å¤æ•°æ®
./backup.sh restore <backup_file>
```

### ç³»ç»Ÿæ£€æŸ¥
```bash
# å¿«é€Ÿæ£€æŸ¥
./check.sh

# ç”Ÿæˆè¯¦ç»†æŠ¥å‘Š
./check.sh --report
```

## ğŸ”„ æ›´æ–°æµç¨‹

1. **å¤‡ä»½æ•°æ®**
   ```bash
   ./backup.sh backup
   ```

2. **æ›´æ–°ä»£ç **
   ```bash
   ./update.sh
   ```

3. **éªŒè¯éƒ¨ç½²**
   ```bash
   ./check.sh
   ```

## ğŸ†˜ æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **åº”ç”¨æ— æ³•å¯åŠ¨**
   - æ£€æŸ¥æ—¥å¿—: `sudo tail -f /var/log/ems-pool-gamble.log`
   - æ£€æŸ¥é…ç½®: `./check.sh`
   - é‡å¯æœåŠ¡: `sudo supervisorctl restart ems-pool-gamble`

2. **æ•°æ®åº“è¿æ¥å¤±è´¥**
   - æ£€æŸ¥æ•°æ®ç›®å½•æƒé™: `ls -la /opt/ems-pool-gamble-data/`
   - æ£€æŸ¥è½¯é“¾æ¥: `ls -la instance/ems_pool_gamble.db`
   - é‡æ–°åˆ›å»ºé“¾æ¥: è¿è¡Œ `./deploy.sh` ä¸­çš„æ•°æ®æŒä¹…åŒ–éƒ¨åˆ†

3. **ç½‘é¡µæ— æ³•è®¿é—®**
   - æ£€æŸ¥ Nginx çŠ¶æ€: `sudo systemctl status nginx`
   - æ£€æŸ¥ç«¯å£å ç”¨: `netstat -tlpn | grep :80`
   - æµ‹è¯•é…ç½®: `sudo nginx -t`

### æ—¥å¿—æ–‡ä»¶ä½ç½®
- **åº”ç”¨æ—¥å¿—**: `/var/log/ems-pool-gamble.log`
- **Nginx è®¿é—®æ—¥å¿—**: `/var/log/nginx/access.log`
- **Nginx é”™è¯¯æ—¥å¿—**: `/var/log/nginx/error.log`
- **ç³»ç»Ÿæ—¥å¿—**: `/var/log/syslog` (Ubuntu) æˆ– `/var/log/messages` (CentOS)

## ğŸ“Š ç›‘æ§å’Œç»´æŠ¤

### å®šæœŸç»´æŠ¤å»ºè®®
1. **æ¯æ—¥**: æ£€æŸ¥æœåŠ¡çŠ¶æ€å’Œæ—¥å¿—
2. **æ¯å‘¨**: åˆ›å»ºæ•°æ®å¤‡ä»½
3. **æ¯æœˆ**: æ¸…ç†æ—§æ—¥å¿—å’Œå¤‡ä»½æ–‡ä»¶
4. **æŒ‰éœ€**: æ›´æ–°åº”ç”¨ä»£ç å’Œç³»ç»Ÿè¡¥ä¸

### è‡ªåŠ¨åŒ–å»ºè®®
å¯ä»¥å°†ä»¥ä¸‹å‘½ä»¤æ·»åŠ åˆ° crontab å®ç°è‡ªåŠ¨åŒ–ï¼š

```bash
# æ¯å¤©å‡Œæ™¨ 2 ç‚¹å¤‡ä»½æ•°æ®
0 2 * * * /path/to/project/backup.sh backup

# æ¯å‘¨æ—¥å‡Œæ™¨ 3 ç‚¹æ¸…ç†æ—§å¤‡ä»½
0 3 * * 0 /path/to/project/backup.sh cleanup
```

## ğŸ”’ å®‰å…¨å»ºè®®

1. **å®šæœŸæ›´æ–°ç³»ç»Ÿ**: `sudo apt update && sudo apt upgrade` (Ubuntu)
2. **é˜²ç«å¢™é…ç½®**: åªå¼€æ”¾å¿…è¦ç«¯å£ (80, 443, 22)
3. **SSL è¯ä¹¦**: å»ºè®®é…ç½® HTTPS
4. **å¤‡ä»½åŠ å¯†**: é‡è¦æ•°æ®å¤‡ä»½å»ºè®®åŠ å¯†å­˜å‚¨
5. **è®¿é—®æ§åˆ¶**: é™åˆ¶ç®¡ç†è„šæœ¬çš„æ‰§è¡Œæƒé™

## ğŸ“ æ”¯æŒ

å¦‚æœé‡åˆ°é—®é¢˜ï¼š
1. è¿è¡Œ `./check.sh --report` ç”Ÿæˆè¯Šæ–­æŠ¥å‘Š
2. æŸ¥çœ‹ç›¸å…³æ—¥å¿—æ–‡ä»¶
3. æ£€æŸ¥æœ¬æ–‡æ¡£çš„æ•…éšœæ’é™¤éƒ¨åˆ†
