# EMS Pool Gamble - 版本历史

## v1.3.3 (2025-06-26)
### 🐛 关键修复
- **修复房间创建时间不匹配问题**: 前端JavaScript直接生成基于用户本地时间的房间名称，后端不再重复计算时间
- **修复iOS Chrome时间显示问题**: 统一所有页面的时间解析逻辑，解决iOS Chrome中显示"Invalid Time"的问题
- **修复数据文件保存错误**: 优化数据文件路径处理逻辑，增加保证机制防止路径为空导致的保存失败

### 🔧 技术改进
- **时间格式统一**: 所有页面使用相同的ISO格式时间解析，兼容各种浏览器
- **房间创建优化**: 移除不必要的时区偏移量传递，简化创建流程
- **数据存储健壮性**: 增加路径验证和降级机制，确保数据能够正常保存

### 📱 跨平台兼容性
- **iOS Chrome支持**: 解决时间字符串解析严格性问题
- **Safari兼容**: 优化时间显示在Safari浏览器中的表现
- **移动端优化**: 改进移动设备上的时间显示体验

## v1.3.2 (2025-06-26)
### 🔧 时区处理重大改进
- **全局时区支持**: 修复所有时间显示和记录的时区错位问题
- **智能时区检测**: 前端自动获取用户时区偏移量，后端统一处理
- **时间戳标准化**: 所有时间记录（场次创建、结束、计分、玩家创建等）都基于用户本地时区
- **跨平台兼容**: 解决不同时区用户看到错误时间的问题

### 🛠️ 技术实现
- 新增时区处理工具函数：`get_user_local_time()` 和 `get_user_local_datetime()`
- 所有POST表单自动包含`timezone_offset`隐藏字段
- JavaScript自动计算并设置用户时区偏移量
- 后端API统一接收时区参数并转换为用户本地时间

### 📝 影响范围
- 场次创建和结束时间
- 计分记录时间戳
- 玩家创建和更新时间
- 快速创建房间名称生成
- 所有相关表单和页面

## v1.3.1 (2025-06-26)
### 🐛 重要修复
- **Azure部署数据持久化修复**: 解决Azure App Service部署后数据丢失问题
- **智能存储路径**: Azure环境自动使用`/home/data`持久化目录，本地环境使用当前目录
- **环境检测**: 自动检测Azure App Service环境，提供相应的存储策略
- **启动日志**: 显示数据存储位置和环境信息，便于调试和监控
- **部署指南**: 新增`AZURE_DEPLOYMENT_GUIDE.md`完整部署说明

### 🔧 技术改进
- 数据文件路径配置函数`get_data_file_path()`
- 自动创建数据目录，确保存储路径存在
- 增强错误处理和日志输出

## v1.3.0 (2025-06-26)
### 🎉 重大重构版本
#### ✨ 核心功能新增
- **玩家系统重构**: 玩家数据与场次数据完全分离，每个玩家拥有唯一的 `player_id`
- **玩家详情页**: 新增 `/player/<player_id>` 路由，展示个人统计、对手分析、历史记录
- **玩家重命名**: 支持玩家重命名功能，自动同步所有历史记录
- **智能玩家跳转**: 所有页面的玩家名字均可点击跳转到玩家详情页

#### 🔄 数据结构升级
- **Players 全局结构**: 新增 `players` 数据结构，管理所有玩家档案
- **Sessions 结构优化**: 使用 `player_ids` 替代玩家名字，所有记录包含 `winner_id/loser_id`
- **自动数据迁移**: 兼容旧版本 `data.json`，自动升级为新数据结构
- **数据一致性**: 玩家重命名后，所有关联数据自动同步更新

#### 🎮 游戏体验优化
- **移除登录系统**: 简化流程，任何人可直接参与游戏
- **智能按钮状态**: 记录按钮始终显示，未满足条件时智能置灰并提示
- **最近玩家推荐**: 支持基于 `player_id` 的智能玩家建议
- **交互体验提升**: 优化按钮选中状态、表单提交、事件处理

#### 📊 统计分析功能
- **个人统计**: 展示总场次、胜率、得分分布等详细数据
- **对手分析**: 显示与每个对手的对战记录和胜负关系
- **历史回顾**: 按时间顺序展示所有参与的场次记录
- **数据可视化**: 优化统计数据的展示方式

#### 🛠️ 技术改进
- **路由重构**: 所有相关路由支持 `player_id` 参数传递
- **模板升级**: 更新所有模板以支持新的数据结构和跳转逻辑
- **代码优化**: 提升数据处理效率，增强代码可维护性
- **为数据库迁移做准备**: 数据结构设计便于未来迁移到关系型数据库

#### 🐛 Bug修复
- 修复分数按钮选中状态异常
- 修复表单提交和 JavaScript 事件处理问题
- 修复特殊分数（14/20）和两败者模式的逻辑错误
- 修复页面间跳转和数据同步问题

## v1.2.1 (2025-06-22)
### 🐛 Bug修复
- 修复场次结束后的session同步问题
- 当一个玩家结束场次时，其他玩家会被自动重定向并清除无效session
- 修复 game.html 中的内联样式问题

### 🎨 界面改进
- 在主页顶部添加版本信息显示
- 所有页面底部显示版本号

## v1.2.0 (2025-06-20)
### ✨ 新功能
- 在进行中的游戏中允许删除计分记录
- 主页顶部显示当前登录状态
- 添加快捷进入游戏链接

### 🎨 界面优化
- 优化计分记录展示，添加删除按钮
- 改进登录状态显示样式
- 统一所有按钮和链接的样式

## v1.1.0 (2025-06-18)
### ✨ 新功能
- 添加场次详情页面
- 实现场次删除功能（仅限已结束场次）
- 优化历史记录页面，移除计分详情到专门页面

### 🔧 技术改进
- 修复Flask/Werkzeug版本冲突
- 添加 .gitignore 文件
- 数据文件不再随代码提交

## v1.0.0 (2025-06-15)
### 🎉 首个稳定版本
- 完整的场次管理功能
- 多玩家计分系统
- 历史记录查看
- 响应式设计
- 用户角色管理（玩家/观战者）

---

## 版本号规则

本项目采用 **语义化版本控制 (Semantic Versioning)**：

格式：`MAJOR.MINOR.PATCH`

- **MAJOR** (主版本号): 不兼容的重大更改
- **MINOR** (次版本号): 向后兼容的功能性新增
- **PATCH** (补丁版本号): 向后兼容的bug修复

### 版本前缀
- `v` 前缀表示正式版本
- 开发版本可使用 `alpha`, `beta`, `rc` 后缀
- 例如：`v1.3.0-beta.1`
