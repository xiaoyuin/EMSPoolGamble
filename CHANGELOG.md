# EMS Pool Gamble - 版本历史

## v2.0.0 (2025-06-25)

### 🚀 重大更新
- **数据库重构**：完全重写数据存储层，从内存+JSON文件迁移到SQLite数据库
- **数据持久化**：使用Flask-SQLAlchemy和SQLite确保数据安全和持久性
- **性能提升**：数据库操作替代内存操作，支持更好的并发性能

### ✨ 新功能
- **自动数据迁移**：支持从旧版本JSON格式自动迁移到数据库
- **启动脚本**：新增`start.py`脚本，自动处理依赖安装和数据迁移
- **数据库服务层**：新增`database_service.py`统一管理数据库操作
- **完整的数据模型**：定义了游戏场次、玩家、分数、记录等完整的数据模型

### 🔧 改进
- **代码架构**：重构为MVC模式，提高代码可维护性
- **错误处理**：改进数据库操作的错误处理和回滚机制
- **兼容性**：保持原有的API接口，确保前端无需修改

### 📁 新增文件
- `models.py` - 数据库模型定义
- `database_service.py` - 数据库服务层
- `migrate_data.py` - 数据迁移脚本
- `start.py` - 应用启动脚本

### 🔄 数据库结构
- `game_sessions` - 游戏场次
- `players` - 玩家信息
- `viewers` - 观众信息
- `player_scores` - 玩家分数
- `game_records` - 游戏记录
- `recent_players` - 最近使用的玩家名

### 📦 依赖更新
- 新增 `Flask-SQLAlchemy==3.1.1`
- 保持其他依赖版本不变

### 🔧 部署说明
- 数据库文件默认保存在 `instance/ems_pool_gamble.db`
- 支持通过 `DATABASE_URL` 环境变量配置其他数据库
- 首次部署会自动创建数据库表结构

---

## v1.2.1 (2025-06-22)
### 🐛 Bug修复
- 修复场次结束后的session同步问题
- 当一个玩家结束场次时，其他玩家会被自动重定向并清除无效session
- 修复 game.html 中的内联样式问题

### 🎨 界面改进
- 在主页顶部添加版本信息显示
- 所有页面底部显示版本号

## v1.2.0 (2025-06-20)
### ✨ 新功能
- 在进行中的游戏中允许删除计分记录
- 主页顶部显示当前登录状态
- 添加快捷进入游戏链接

### 🎨 界面优化
- 优化计分记录展示，添加删除按钮
- 改进登录状态显示样式
- 统一所有按钮和链接的样式

## v1.1.0 (2025-06-18)
### ✨ 新功能
- 添加场次详情页面
- 实现场次删除功能（仅限已结束场次）
- 优化历史记录页面，移除计分详情到专门页面

### 🔧 技术改进
- 修复Flask/Werkzeug版本冲突
- 添加 .gitignore 文件
- 数据文件不再随代码提交

## v1.0.0 (2025-06-15)
### 🎉 首个稳定版本
- 完整的场次管理功能
- 多玩家计分系统
- 历史记录查看
- 响应式设计
- 用户角色管理（玩家/观战者）

---

## 版本号规则

本项目采用 **语义化版本控制 (Semantic Versioning)**：

格式：`MAJOR.MINOR.PATCH`

- **MAJOR** (主版本号): 不兼容的重大更改
- **MINOR** (次版本号): 向后兼容的功能性新增
- **PATCH** (补丁版本号): 向后兼容的bug修复

### 版本前缀
- `v` 前缀表示正式版本
- 开发版本可使用 `alpha`, `beta`, `rc` 后缀
- 例如：`v1.3.0-beta.1`
